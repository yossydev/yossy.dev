---
title: "ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ãŸNovaã®TypedArray.prototype.indexOfã®æœ€é©åŒ–"
description: "a"
date: "2025/03/09"
updatedAt: "2025/03/09"
path: "nova-typed-array-indexOf-more-optimized"
published: true
---

## Intro

å…ˆæ—¥ã€Novaã«`%TypedArray%.prototype.indexOf`([#556](https://github.com/trynova/nova/pull/556))ã¨ã„ã†PRãŒãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸã€‚

å¤§æ ã®éƒ¨åˆ†ã¯ä»–ã®å®Ÿè£…ã¨åŒã˜ãªã‚“ã§ã™ãŒã€ä»Šå›è¡Œã£ãŸæœ€é©åŒ–ã®æ–¹æ³•ãŒå‚è€ƒã«ãªã£ãŸã®ã§ãƒ¡ãƒ¢ãŒã¦ã‚‰æ®‹ã—ã¦ãŠãã¾ã™ã€‚

ãªãŠã€ã¾ã ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¯å–ã£ã¦ã„ãªã„ã®ã§ã€å¤šåˆ†ã“ã£ã¡ã®æ–¹ãŒæ—©ã„ç¨‹åº¦ã§ã™ã€‚

## %TypedArray%.prototype.indexOfã®ä»•æ§˜

[%TypedArray%.prototype.indexOf](https://tc39.es/ecma262/multipage/indexed-collections.html#sec-%typedarray%.prototype.indexof)ã¯ã€
å¼•æ•°ã«å—ã‘å–ã£ãŸå€¤ã®indexç•ªå·ç›®ã®å€¤ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚

åŸºæœ¬çš„ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```ts
// ref: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray/indexOf#try_it

const uint8 = new Uint8Array([10, 20, 30, 40, 50]);

console.log(uint8.indexOf(50));
// Expected output: 4
```

ãã—ã¦ã€ã‚‚ã—æŒ‡å®šã—ãŸå€¤ãŒå­˜åœ¨ã—ãªã‹ã£ãŸå ´åˆã¯-1ã‚’è¿”ã—ã¾ã™ã€‚
ã‚ã¨ã¯ç¬¬äºŒå¼•æ•°ã®fromIndexã«å€¤ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€indexç•ªç›®ç§»è¡Œã‹ã‚‰æ¢ç´¢ã‚’å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚

```ts
// From position 3
console.log(uint8.indexOf(20, 3));
// Expected output: -1

console.log(uint8.indexOf(51));
// Expected output: -1
```

åŸºæœ¬çš„ã«ã¯[Array.prototype.indexOf()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf)ã¨åŒã˜ã§ã™ãŒã€
TypedArrayã¯[TypedArray objects](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray#typedarray_objects)ã—ã‹æ‰±ãˆã¾ã›ã‚“ã€‚

### ä»•æ§˜æ›¸ã‚’è¦‹ã‚‹
ã“ã“ã§ã€ä»Šå›ã®æœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆã§ã‚ã‚‹ã€indexOfã®æ¢ç´¢æ–¹æ³•ã‚’ç¢ºèªã—ã¾ã™ã€‚

ã“ã‚Œã¯ã€ä»•æ§˜æ›¸ã‚’è¦‹ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```
11. Repeat, while k < len,
    a. Let Pk be ! ToString(ğ”½(k)).
    b. Let kPresent be ! HasProperty(O, Pk).
    c. If kPresent is true, then
       i. Let elementK be ! Get(O, Pk).
       ii. If IsStrictlyEqual(searchElement, elementK) is true, return ğ”½(k).
    d. Set k to k + 1.
```

lenã¯TypedArrayã®legnthã§ã€kã¯ã“ã“ã§ã¯æœ€åˆã¯0ã¨ã—ã¦è€ƒãˆã¦ã‚‚ã‚‰ã£ã¦å•é¡Œãªã„ã§ã™ã€‚

ãã—ã¦ã€lengthãŒkeyã‚ˆã‚Šå¤§ãã„æ•°å­—ã§ã‚ã‚‹é™ã‚Šã€ãƒ«ãƒ¼ãƒ—ã‚’ç¶šã‘ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã‚ŒãŒæœ€çµ‚çš„ã«ã€indexOfã«æ¸¡ã•ã‚ŒãŸå¼•æ•°ï¼ˆsearchElementï¼‰ã¨ã€TypedArrayã«å®šç¾©ã—ãŸå€¤ï¼ˆelementK)ã‚’æ¯”è¼ƒã—ã€ç­‰ä¾¡ã§ã‚ã‚Œã°ã€kã‚’è¿”ã™ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

## è¡Œã£ãŸæœ€é©åŒ–

indexOfã®æœ€å¾Œã®æ¢ç´¢ã¯ã‚ˆã†ã¯å˜ç´”ãªãƒ«ãƒ¼ãƒ—å‡¦ç†ã§ã—ãŸã€‚

ãªã®ã§ç­†è€…ã‚‚ã“ã‚Œã‚’å®Ÿè£…ã—ãŸéš›ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ„šç›´ã«ãƒ«ãƒ¼ãƒ—å‡¦ç†ã‚’è¡Œã„ã¾ã—ãŸã€‚

## è‹¦æˆ¦ã—ãŸãƒã‚¤ãƒ³ãƒˆ

### Rustãã®ã‚‚ã®ã®ç†è§£

### 

## ã¾ã¨ã‚